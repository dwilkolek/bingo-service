!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports=require("uuid")},function(e,t,r){const s=r(2),n=r(9)(),o=r(10);var a=r(11).createServer(n);n.use(o.json()),n.use(o.urlencoded({extended:!0}));var i=r(12)(a);const l={};i.on("connection",e=>{let t,r,s;console.log("connected"),e.on("join-game",n=>{console.log("join-game",n),t=n.gameId,r=n.playerId,s=n.operatorHash,e.join(t),t&&l[t]&&r&&l[t].players[r]&&(console.log("adding socket ",r,e.id),l[t].players[r].addSocket(e.id),console.log("player-count",l[t].getPlayerCount()),i.in(t).emit("player-count",l[t].getPlayerCount()))}),e.on("get-winner",()=>{l[t]&&e.emit("winner",l[t].winner)}),e.on("get-status",()=>{l[t]&&e.emit("status",l[t].status)}),e.on("get-player-count",()=>{l[t]&&e.emit("player-count",l[t].getPlayerCount())}),e.on("get-last-call",()=>{l[t]&&e.emit("last-call",l[t].lastCalledNumber)}),e.on("disconnecting",()=>{t&&r&&l[t]&&l[t].players[r]&&(l[t].players[r].removeSocket(e.id),i.in(t).emit("player-count",l[t].getPlayerCount()))}),e.on("toggle-mark",e=>{console.log("toggle-mark",e),t&&r&&l[t].markCardForPlayer(r,e.cardId,e.row,e.col)}),e.on("bingo",e=>{console.log("bingo",e),t&&r&&l[t].callBingo(r,e).then(()=>{i.in(""+t).emit("status",l[t].status),i.in(""+t).emit("winner",l[t].winner)}).catch(e=>{console.error(e)})}),e.on("start-game",()=>{l[t].startGame(s).then(()=>{i.in(""+t).emit("status",l[t].status)}).catch(e=>{console.error(e)})}),e.on("next-call",()=>{console.log("next-call"),l[t].operatorCall(s).then(e=>{console.log("call",e),i.in(""+t).emit("call",e)}).catch(e=>{console.error(e)})})});var u=e=>({id:e.id,name:e.name,operatorHash:e.operatorHash,status:e.status,playersCount:Object.keys(e.players).length,lastCalledNumber:e.lastCalledNumber,calledNumbers:e.calledNumbers}),c=e=>({id:e.id,name:e.name,status:e.status,playersCount:Object.keys(e.players).length,lastCalledNumber:e.lastCalledNumber});n.post("/api/game",(e,t)=>{const r=new s(e.body.name);l[r.id]=r,t.send(u(r))}),n.get("/api/game/:gameId/:operatorHash",(e,t)=>{const r=e.params.gameId;if(!l[r])throw"no-such-game";const s=e.params.operatorHash;l[r].operatorHash==s?t.send(u(l[r])):t.status(500).send("you-are-not-an-operator")}),n.get("/api/game/:gameId/",(e,t)=>{const r=e.params.gameId;if(!l[r])throw"no-such-game";t.send(c(l[r]))}),n.get("/api/game",(e,t)=>{t.send(Object.keys(l).map(e=>c(l[e])))}),n.post("/api/game/:gameId/call",(e,t)=>{const r=e.params.gameId;if(!l[r])throw"no-such-game";const s=e.body.operatorHash;l[r].operatorCall(s).then(e=>{i.in(""+r).emit("operatorCalled",e),t.send(l[r].calledNumbers)}).catch(e=>{console.error(e),t.status(500).send(e)})}),n.get("/api/game/:gameId/player/:playerId",(e,t)=>{const r=e.params.gameId;if(!l[r])throw"no-such-game";l[r].getPlayer(e.params.playerId).then(e=>{t.send(e)}).catch(e=>{t.status(500).send(e)})}),n.post("/api/game/:gameId/subscribe",(e,t)=>{const r=e.params.gameId;if(!l[r])throw"no-such-game";const s=e.body.playerName,n=e.body.cards;t.send(l[r].subscribe(s,n))}),a.listen(8080,()=>console.log("Example app listening at http://localhost:8080"))},function(e,t,r){const{v4:s}=r(0),n=r(3),o=r(4);var a="WAITING_FOR_PLAYERS",i="STARTED",l="FINISHED",u="ALL_EVEN",c="UP_TO";e.exports=class{constructor(e){this.status=a,this.players={},this.leftNumbers=[],this.calledNumbers=[],this.lastCalledNumber=null,this.rule=n.ONE_LINE,this.cardLimit=3,this.cardRule=u,this.winner=null,this.id=s(),this.name=e,this.operatorHash=s();for(let e=1;e<=75;e++)this.leftNumbers.push(e);this.leftNumbers=this.leftNumbers.sort((e,t)=>Math.random()-.5)}subscribe(e,t){const r=new o(e);return t||(t=1),(u==this.cardRule||c==this.cardRule&&t>this.cardLimit)&&(t=this.cardLimit),r.createBingoCards(t),this.players[r.id]=r,r}operatorCall(e){return new Promise((t,r)=>{if(this.operatorHash===e)if(this.leftNumbers.length>0){const e=this.leftNumbers.pop();this.calledNumbers.indexOf(e)>-1&&r("allready-called"),this.status===l&&r("game-already-finished"),this.status===a&&r("game-is-not-started"),this.calledNumbers.push(e),this.lastCalledNumber=e,t(e)}else r("no-numbers-left-to-call");else r("not-an-operator")})}startGame(e){return new Promise((t,r)=>{this.operatorHash===e?(this.status=i,t()):r("not-an-operator")})}callBingo(e,t){return new Promise((r,s)=>{try{const s=this.players[e];if(!s)throw"no-such-player";if(!s.getCard(t).checkBingo(this.rule,this.calledNumbers))throw"not-a-bingo";this.status=l,this.winner={cardId:t,player:s},r(this.winner)}catch(e){s(e)}})}markCardForPlayer(e,t,r,s){try{this.players[e]&&this.players[e].getCard(t).mark(r,s)}catch(e){console.warn(e)}}getPlayer(e){return new Promise((t,r)=>{const s=this.players[e];s?t(s):r("no-such-player")})}getPlayerCount(){const e=Object.keys(this.players);return{total:e.length,online:e.filter(e=>this.players[e].isOnline()).length}}}},function(e,t){e.exports={ONE_LINE:(e,t)=>{for(let r=0;r<e.length;r++){if(e[r].map(e=>e.marked&&(null==e.value||t.indexOf(e.value)>-1)).reduce((e,t)=>e&&t,!0))return!0}return!1}}},function(e,t,r){const{v4:s}=r(0),n=r(5);e.exports=class{constructor(e){this.bingoCards={},this.sockets=[],this.id=s(),this.name=e}createBingoCards(e){for(let t=0;t<e;t++){const e=new n(this.id);this.bingoCards[e.id]=e}}getCard(e){if(this.bingoCards[e])return this.bingoCards[e];throw"no-such-card"}addSocket(e){this.sockets.push(e)}removeSocket(e){this.sockets=this.sockets.filter(t=>t!=e)}isOnline(){return this.sockets.length>0}}},function(e,t,r){const s=r(6),n=r(7);var o=r(8);e.exports=class{constructor(e){this.id=o.generate(),this.playerId=e,this.numbers=[];for(var t=0;t<5;t++)for(var r=new s(15*t+1,15*(t+1)).getRandomNumbers(5),a=0;a<5;a++)this.numbers[a]||(this.numbers[a]=[]),this.numbers[a][t]=new n(2==t&&2==a?null:r.pop())}checkBingo(e,t){return e(this.numbers,t)}mark(e,t){this.numbers[e][t].marked=!this.numbers[e][t].marked}}},function(e,t){e.exports=class{constructor(e,t){this.numbers=[];for(let r=e;r<=t;r++)this.numbers.push(r)}getRandomNumber(){return this.numbers=this.numbers.sort((e,t)=>Math.random()>=.5?1:-1),this.numbers.pop()}getRandomNumbers(e){for(var t=[],r=0;r<e;r++)t.push(this.getRandomNumber());return t.sort()}}},function(e,t){e.exports=class{constructor(e){this.value=e,this.marked=!1}}},function(e,t){e.exports=require("short-uuid")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("socket.io")}]);